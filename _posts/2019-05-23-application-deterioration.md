---
title: "어플리케이션 성능 저하의 원인"
layout: post
category: PROJECT
tags: [Java, MySQL]
excerpt: "어플리케이션 성능 저하의 원인에 대해서 배워 봅시다."
author: BAEKJungHo
---

* content
{:toc}

## 어플리케이션 성능 저하 원인

### DB 연결 및 쿼리 수행

  DB 연결 및 쿼리 수행시 발견되는 문제점은 다음과 같습니다.

  - __SLOW QUERY & DB Lock__

    - Slow Query, 과도한 업데이트, 인덱싱이 발생할 경우 Database는 Lock이 발생합니다. Database에 Lock이 발생하면, 해당 Row에 접근하는 요청들은 Lock이 풀릴 때까지 대기하거나 Timeout 됩니다. 이는 웹 애플리케이션 성능이 저하되는 대표적인 원인이며 이로 인해 장애가 발생하기도 합니다

  - __불필요한 DB Fetch__

    - 요청하는 데이터의 건수가 많을 수록 응답 시간이 느려집니다. 실제 필요한 데이터는 상위 몇 개인데  대량의 데이터를 요청하였거나, ResultSet에서 Last로 커서로 이동시키는 작업들이 빈번해지면 응답시간이 현저히 느려지고 Out Of Memory가 발생합니다. ORM에서 생성된 쿼리들도 주의깊게 보셔야 합니다

  - __Connection Leak, 부적절한 Connection Pool Size__

    - 문제의 핵심은 Connection Pool 사이즈를 너무 작거나 너무 크게 설정한 경우 성능에 안 좋은 영향을 미칠 수 있다는 것입니다. 특히, Connection의 개수를 설정하지 않으면 10~20 정도의 default값이 적용되기 때문에 동시 사용자가 많은 경우에는 Connection의 개수를 그에 맞게 적절히 조절해야 합니다. 자바에는 Connection, Statement, ResultSet 등DB Connection과 관련된 JDBC 객체가 존재합니다. 이러한 객체는 사용한 후 close를 하지 않으면 Connection이 Pool에 반환되지 않아 Connection Leak이 발생되며, 부작용으로 DB에 접근하는 트랜잭션들이 Connection을 얻지 못 하고 대기하여 요청 시간이 현저히 느려지거나, 최악의 경우에는 장애가 발생할 수 있습니다.

### 외부 호출

  - __외부 호출(HTTP, 소켓 통신 등)__

    - 트랜잭션 안에 포함된 또 다른 외부 트랜잭션(외부 호출)이 긴 시간 수행된다거나, Timeout이 발생하는 경우 성능 저하가 발생합니다. 예를 들어 택시 호출 앱을 호출했을 경우, 위치 정보를 얻기 위해 지도 서비스를 호출해야 되는 경우입니다.

  - __긴 시간 실행되는 내부 로직 수행__

    - 모바일 애플리케이션에서, 데이터를 다 전송받지 못 하고 인터넷 접속이 불능 상태가 되었을 때 (서버 소켓 Write는 계속 일어나고 있으나, 모바일 애플리케이션이 비정상적으로 Read가 수행되지 않은 경우)
    - 특정 파일을 업로드 하거나, 다운로드 하는 상황 등
    - 예외 처리를 제대로 하지 않아 행이 걸리는 상황 등

### 환경설정및 네트워크

  - __환경설정 및 네트워크__

    - 너무 작게 설정된 Thread Pool
    - 너무 작게 설정된 Heap Memory
    - 과도한 서비스 요청 증가 (처리 능력 초과)
    - 네트워크 장비로 인한 데이터 손실
