---
title: "DATABASE KEY AND TABLE"
layout: post
category: DataBase
tags: [MySQL, Oracle]
excerpt: "기본키, 복합키, 외래키의 설정 방법에 대해서 배워 봅시다."
author: BAEKJungHo
---

* content
{:toc}

## 목표

  > 기본키, 복합키, 외래키의 설정 방법에 대해서 배워 봅시다.

## 테이블 설계

  테이블 설계시 1개의 테이블로 처리할 수 있는것을 2개 혹은 3개로 나누는 경우가 있습니다.
  그 이유는 분리해야하는 테이블이 중요한 역할을 하는 경우(EX) 개인정보)와 조회가 편한경우, 즉 검색 속도를 위해서
  분리하기도 합니다.

  따라서 테이블을 분리할지 하지 않을지에 대한 판단은 자신이 세워야 합니다.

## 기본키(Primary Key)

  > 기본키(Primary Key) : 각각의 ROW를 고유하게 식별할 수 있는 KEY

  유일성과 최소성을 가지며 튜플을 식별하기 위해 반드시 필요한 키이며, NULL 값을 가질 수 없습니다.

  - 유일성(Unique) : 하나의 키 값으로 하나의 튜플만을 유일하게 식별할 수 있어야 합니다.

  - 최소성(Minimality) : 모든 레코드들을 유일하게 식별하는 데 꼭 필요한 속성으로만 구성되어야 합니다.

### 자연키(Natural Key)

  > 자연키(Natural Key) : 비즈니스 모델에서 자연스레 나오는 속성으로 정하는 기본키

  예를들어 회원 테이블(Member Table)을 만들때, 테이블의 컬럼을 정해야 할 것입니다.
  테이블의 컬럼은 Java로 따지면 `관심 영역(Application Boundary)`를 정하는 것입니다. __즉, 구현하고자 하는 객체의
  필요한 속성만 뽑아서 테이블의 컬럼으로 만드는 것입니다.__

  > 회원 테이블(Member Table)의 속성 : 회원 ID, 이름, 전화번호, 주소, 성별

  관심 영역을 정하고 뽑아낸 속성이 `회원 ID, 이름, 전화번호, 주소, 성별`이라고 할 때, 컬럼에 대한 값들이 입력되면
  로우(ROW, 행)가 하나씩 추가될 것입니다. 그럼 이제 기본키(Primary Key)를 정해야 합니다. 기본키를 설정할 때에 고려해야할 것은
  `중복 가능성이 없는 컬럼(속성)`을 고르는 것입니다.

  어떤 컬럼을 기본키로 지정해주면 좋을까?

  이름은 동명이인이 존재하므로 중복 가능성이 있습니다. 따라서 배제.

  주소는 한 주소에 2명이 살 경우, 충분히 중복 가능성이 있습니다. 따라서 배제.

  성별은 남, 녀 남자1명, 여자 1명 총 2명만 회원으로 받을 것이 아니기 때문에 배제.

  남은것은 전화번호와 ID인데, __전화번호는 변경이 가능하고, 생각보다 변경이 잦기 때문에, 변경이 있는 값을 기본키로 하면 좋지 않습니다.__
  따라서 남은건 ID뿐이고 회원ID는 중복되지않으며, 변경될 여지도 거의없습니다.

  기본키만을 위한 데이터가 아니라 비즈니스 모델에서 자연스레 나오는 속성으로 기본키를 정한다고해서 `자연키(Natural Key)`라고 표현합니다.
  자연키는 `업무키 (Business Key)`라고도 합니다.

### 인조키(Artificial Key)

  > 인조키(Artificial Key) : 비즈니스 모델과는 달리 키(Key)를 위한 데이터

  앞에서 회원테이블을 만들었는데, 보통 회원이라는건 가입자한테 그 사실을 알려주고(DB차원에서 기본키랑은 상관없이)그 회원의 `고유한 값`을 전달해주게된다. 거기서 자연스레 고유한 값은 ID가 추출됐고, 그걸 기본키로 설정한것입니다.

  이번에는 회원 테이블과 비슷하지만 조금 다른 이벤트 참여 개인정보를 제공받는 테이블을 만들어 보겠습니다.

  > 이벤트 참여 개인정보 테이블 : 참여자 이름, 전화번호, 주소, 성별

  이 테이블에서는 ID와 같은 고유한 값이 없습니다. 변할가능성은 어느정도있지만 그래도 고유함은 보장할 수 있는 전화번호는 어떨까?
  일리있는 생각이지만 1~2달 쓰고 종료할 시스템이 아니라면 좋은생각은 아닙니다.

  생각을 조금 바꿔보자 고유한 값을 꼭 회원이나 참여자로부터 입력받아야할까? 입력받는게 없으면 우리가 부여하면 되는거 아닐까? 카페에서 커피를 시킬때를 생각해봅시다. 우리는 그냥 돈내고 결제만 하면 끝나지만 종업원으로부터 대기자들 중 우리를 식별할 수 있는 번호표를 받습니다(호출기도 잘 살펴보면 고유번호가 있다.). 마찬가지로 우리가 부여하면됩니다.

  > 이벤츠 참여 개인정보 테이블 : 참여자 번호 추가

  우리가 부여한 `참여자번호`로 인해 우리는 참여자가 몇명이든 그들을 구분할 수 있는 속성을 갖게됐습니다. __DBMS적인 측면에서 본다면 Oracle의 Sequence, MySQL의 Auto Increment라고 보면됩니다.__ 비즈니스 모델과는 달리 키를 위한 데이터라는 측면에서 인조키(Artificial Key)라고 부릅니다.

  인조키를 만드는 다른 방법 중 하나는 __비즈니스키를 이어붙여서(concatenate) 하나의 컬럼으로 만들어 사용__ 하는 것입니다.

  만약 원래 컬럼들의 길이가 다음과 같다고 가정하면

  지점코드(4) + 팀코드(3) + 보험유형구분(1) + 계약연도(4) + 일련번호(4)

  인조키의 킬이는 이렇게 됩니다. 보험계약내역식별번호(16)

  다른 방법은 __시퀀스와 같은 충분히 긴 길이의 일련번호를 만들어 사용__ 하는 것입니다.

  - 복합키  : "AAA" + "T10" + "3" + "2013" + "0130"
  - 인조키1 : "AAAT10320130130"
  - 인조키2 : "0000000240"

### 부연 설명

  비즈니스 모델에서 자연히 얻게되는 자연키와 기본키만을 위한 인조키 중 어떤걸 사용하는게 더 좋을까? 앞선 내용에서 알아본것처럼 자연키가 있으면 자연키를 사용하고, 없으면 인조키를 사용하는 선자연키 후인조키 전략이 좋은걸까?

  각각의 비즈니스에 따라 갈리는게 당연한일이므로 명확한 정답이 있는건 아니지만 __보통의 경우 자연키보다는 인조키를 사용하는게 좋고, 그렇게 권장한합니다.__

  기본키는 최대한 변하지않는 값이어야하는데(__실제 값이 변하지않는 측면에서도 그렇지만 그 값이 의미하는 바도 변하지않는게 좋다.__) 비즈니스 모델에서 추출한 자연키는 비즈니스 규칙에 의해 값 혹은 그 의미가 변할 여지가 다분합니다.

  간단한 예로 대한민국 국민은 기본키를 부여받고 살아가게됩니다. 바로 주민번호 입니다. 지금이야 상상할수도 없지만 이전에는 별 시덥잖은 사이트에 가입할때도 필수적으로 주민번호를 입력해야했습니다. 만약 그때 주민번호를 기본키로 잡아놨다면 그 사이트는 정부의 대대적인 보안정책으로 인해 피똥싸는 수정을 했어야할것입니다. 주민번호가 갖는 그 고유한 특성 자체는 변하지않았지만 그 값이 갖는 의미가 변했기때문에 더이상 데이터베이스에 영구히 보관할수가 없어진 탓입니다.

  단순히 회원 테이블의 기본키로만 쓰인게 아니라 여기저기 외래키로도 사용됐다면 그 사이트는 시스템 전체를 들었다놔야하는 상황을 맞이할수도 있었을것입니다.

## 복합키(Composite Key)와 외래키(Foreign Key)

  > 복합키(Composite Key) : 2개 이상의 컬럼으로 기본키를 지정한 것
  >
  > 외래키(Foreign Key) : X테이블에서 Y테이블의 기본키를 참조하는 키


  복합키는 2개 이상의 컬럼으로 기본키를 지정한 것을 말합니다. 2개의 컬럼으로 기본키를 지정해도 상관은 없지만, 만약 3, 4개의 컬럼으로 기본키를 지정하게 될 경우, 변경가능성의 여지가 있을 가능성이 크며, SQL Query를 작성할 때 Join과 where절을 복잡하게 써야 할 것입니다.

  만약 X테이블에서 2개의 컬럼(A, B)으로 기본키를 지정한 경우, Y테이블에서 A기본키를 참조하기 위해서는 `FOREIGN KEY (컬럼명) REFERENCES Xtable(A)`를 사용해야하고, B기본키를 참조하기 위해서는  `FOREIGN KEY (컬럼명) REFERENCES Xtable(B)`를 사용해야 합니다.

  즉, 둘 다 참조하기 위해서는 FOREIGN KEY 구문을 2번 써줘야 합니다.

  복합키를 줘도 충분한 상황이면 줘도 되지만, 3개이상일 경우에는 위에서 배운 인조키를 이용하는 편이 훨씬 낫습니다.

## 기본키와 외래키의 차이점

  기본키는 NULL 값 불가능 BUT 외래키는 중복 가능하면서 NULL도 가능

## UNIQUE 제약

  UNIQUE 제약은 데이터를 식별하기 위한 무결성 제약이며, PRIMARY KEY와 다른점은, `NULL 값을 허용` 한다는 점입니다.
  그리고 하나의 테이블에서 두 개 이상의 컬럼에 제약을 걸 수 있습니다.

## 참조

  > [https://multifrontgarden.tistory.com/180](https://multifrontgarden.tistory.com/180)
